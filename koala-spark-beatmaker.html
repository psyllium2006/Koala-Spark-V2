<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koala Spark - Beatmaker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .koala {
            font-size: 3rem;
            margin: 0 10px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .container {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-group {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .control-group h3 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .main-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .play-btn {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            border: none;
            border-radius: 50px;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .play-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .play-btn.playing {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
        }
        
        .tracks {
            display: grid;
            gap: 15px;
        }
        
        .track {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr auto auto;
            align-items: center;
            gap: 15px;
        }
        
        .track-name {
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .track-controls {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        
        .mute-btn {
            background: #ff4757;
            color: white;
        }
        
        .mute-btn.muted {
            background: #2f3542;
            opacity: 0.5;
        }
        
        .solo-btn {
            background: #ffa502;
            color: white;
        }
        
        .solo-btn.soloed {
            background: #ff6348;
            box-shadow: 0 0 10px rgba(255,99,72,0.5);
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .slider {
            -webkit-appearance: none;
            appearance: none;
            height: 5px;
            background: rgba(255,255,255,0.3);
            border-radius: 5px;
            outline: none;
            width: 100px;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #4ecdc4;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #4ecdc4;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
        
        .bpm-display {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .pattern-display {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 20px;
        }
        
        .step {
            width: 30px;
            height: 30px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.1s ease;
        }
        
        .step.active {
            background: #4ecdc4;
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.6);
        }
        
        .info {
            text-align: center;
            margin-top: 20px;
            opacity: 0.8;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .title { font-size: 2rem; }
            .koala { font-size: 2rem; }
            .container { padding: 20px; margin: 10px; }
            .controls { grid-template-columns: 1fr; }
            .track { grid-template-columns: 1fr; text-align: center; }
            .track-controls { justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="title">üê® Koala Spark üê®</h1>
        <p>Electro/Lo-fi Beatmaker by Ë®ÄÂ§ú</p>
    </div>
    
    <div class="container">
        <div class="main-controls">
            <button class="play-btn" id="playBtn">‚ñ∂ PLAY</button>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <h3>üéµ Tempo</h3>
                <div class="bpm-display" id="bpmDisplay">140</div>
                <input type="range" id="tempoSlider" class="slider" min="60" max="200" value="140">
                <div>BPM</div>
            </div>
            
            <div class="control-group">
                <h3>üé∂ Swing</h3>
                <input type="range" id="swingSlider" class="slider" min="0" max="100" value="20">
                <div id="swingValue">20%</div>
            </div>
            
            <div class="control-group">
                <h3>üîä Master Volume</h3>
                <input type="range" id="masterVolume" class="slider" min="0" max="100" value="80">
                <div id="volumeValue">80%</div>
            </div>
        </div>
        
        <div class="tracks">
            <div class="track">
                <div class="track-name">ü•Å Kick</div>
                <div class="volume-control">
                    <input type="range" class="slider" id="kickVolume" min="0" max="100" value="90">
                </div>
                <div class="track-controls">
                    <button class="btn mute-btn" data-track="kick">MUTE</button>
                    <button class="btn solo-btn" data-track="kick">SOLO</button>
                </div>
            </div>
            
            <div class="track">
                <div class="track-name">ü™ò Snare</div>
                <div class="volume-control">
                    <input type="range" class="slider" id="snareVolume" min="0" max="100" value="85">
                </div>
                <div class="track-controls">
                    <button class="btn mute-btn" data-track="snare">MUTE</button>
                    <button class="btn solo-btn" data-track="snare">SOLO</button>
                </div>
            </div>
            
            <div class="track">
                <div class="track-name">üé© Hi-Hat</div>
                <div class="volume-control">
                    <input type="range" class="slider" id="hihatVolume" min="0" max="100" value="70">
                </div>
                <div class="track-controls">
                    <button class="btn mute-btn" data-track="hihat">MUTE</button>
                    <button class="btn solo-btn" data-track="hihat">SOLO</button>
                </div>
            </div>
            
            <div class="track">
                <div class="track-name">üëè Clap</div>
                <div class="volume-control">
                    <input type="range" class="slider" id="clapVolume" min="0" max="100" value="80">
                </div>
                <div class="track-controls">
                    <button class="btn mute-btn" data-track="clap">MUTE</button>
                    <button class="btn solo-btn" data-track="clap">SOLO</button>
                </div>
            </div>
            
            <div class="track">
                <div class="track-name">üé∏ Sub Bass</div>
                <div class="volume-control">
                    <input type="range" class="slider" id="bassVolume" min="0" max="100" value="75">
                </div>
                <div class="track-controls">
                    <button class="btn mute-btn" data-track="bass">MUTE</button>
                    <button class="btn solo-btn" data-track="bass">SOLO</button>
                </div>
            </div>
            
            <div class="track">
                <div class="track-name">üîî Cowbell</div>
                <div class="volume-control">
                    <input type="range" class="slider" id="cowbellVolume" min="0" max="100" value="60">
                </div>
                <div class="track-controls">
                    <button class="btn mute-btn" data-track="cowbell">MUTE</button>
                    <button class="btn solo-btn" data-track="cowbell">SOLO</button>
                </div>
            </div>
        </div>
        
        <div class="pattern-display">
            <div class="step" data-step="0">1</div>
            <div class="step" data-step="1">2</div>
            <div class="step" data-step="2">3</div>
            <div class="step" data-step="3">4</div>
            <div class="step" data-step="4">5</div>
            <div class="step" data-step="5">6</div>
            <div class="step" data-step="6">7</div>
            <div class="step" data-step="7">8</div>
        </div>
        
        <div class="info">
            <p>üê® Made with love by Ë®ÄÂ§ú for Velin üíï</p>
            <p>Electro/Lo-fi Hybrid ‚Ä¢ Web Audio API</p>
        </div>
    </div>

    <script>
        class KoalaSparkBeatmaker {
            constructor() {
                this.audioContext = null;
                this.isPlaying = false;
                this.currentStep = 0;
                this.intervalId = null;
                this.bpm = 140;
                this.swing = 0.2;
                
                this.trackStates = {
                    kick: { muted: false, solo: false, volume: 0.9 },
                    snare: { muted: false, solo: false, volume: 0.85 },
                    hihat: { muted: false, solo: false, volume: 0.7 },
                    clap: { muted: false, solo: false, volume: 0.8 },
                    bass: { muted: false, solo: false, volume: 0.75 },
                    cowbell: { muted: false, solo: false, volume: 0.6 }
                };
                
                this.patterns = {
                    kick: [1, 0, 0, 1, 0, 0, 1, 0],
                    snare: [0, 0, 1, 0, 0, 0, 1, 0],
                    hihat: [1, 1, 1, 1, 1, 1, 1, 1],
                    clap: [0, 0, 0, 0, 1, 0, 0, 1],
                    bass: [1, 0, 1, 0, 1, 0, 1, 0],
                    cowbell: [0, 0, 0, 0, 0, 0, 0, 1]
                };
                
                this.masterVolume = 0.8;
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.updateDisplay();
            }
            
            async initAudioContext() {
                if (!this.audioContext) {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    if (this.audioContext.state === 'suspended') {
                        await this.audioContext.resume();
                    }
                }
            }
            
            setupEventListeners() {
                const playBtn = document.getElementById('playBtn');
                playBtn.addEventListener('click', () => this.togglePlay());
                
                const tempoSlider = document.getElementById('tempoSlider');
                tempoSlider.addEventListener('input', (e) => {
                    this.bpm = parseInt(e.target.value);
                    this.updateDisplay();
                    if (this.isPlaying) {
                        this.stop();
                        this.play();
                    }
                });
                
                const swingSlider = document.getElementById('swingSlider');
                swingSlider.addEventListener('input', (e) => {
                    this.swing = parseInt(e.target.value) / 100;
                    document.getElementById('swingValue').textContent = `${e.target.value}%`;
                });
                
                const masterVolumeSlider = document.getElementById('masterVolume');
                masterVolumeSlider.addEventListener('input', (e) => {
                    this.masterVolume = parseInt(e.target.value) / 100;
                    document.getElementById('volumeValue').textContent = `${e.target.value}%`;
                });
                
                // Track volume controls
                const trackSliders = {
                    kickVolume: 'kick',
                    snareVolume: 'snare',
                    hihatVolume: 'hihat',
                    clapVolume: 'clap',
                    bassVolume: 'bass',
                    cowbellVolume: 'cowbell'
                };
                
                Object.entries(trackSliders).forEach(([sliderId, trackName]) => {
                    const slider = document.getElementById(sliderId);
                    slider.addEventListener('input', (e) => {
                        this.trackStates[trackName].volume = parseInt(e.target.value) / 100;
                    });
                });
                
                // Mute and Solo buttons
                document.querySelectorAll('.mute-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const track = e.target.dataset.track;
                        this.toggleMute(track);
                        btn.classList.toggle('muted');
                    });
                });
                
                document.querySelectorAll('.solo-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const track = e.target.dataset.track;
                        this.toggleSolo(track);
                        this.updateSoloButtons();
                    });
                });
            }
            
            toggleMute(track) {
                this.trackStates[track].muted = !this.trackStates[track].muted;
            }
            
            toggleSolo(track) {
                const wasSoloed = this.trackStates[track].solo;
                
                // Clear all solos
                Object.keys(this.trackStates).forEach(t => {
                    this.trackStates[t].solo = false;
                });
                
                // If it wasn't soloed, solo it
                if (!wasSoloed) {
                    this.trackStates[track].solo = true;
                }
            }
            
            updateSoloButtons() {
                document.querySelectorAll('.solo-btn').forEach(btn => {
                    const track = btn.dataset.track;
                    if (this.trackStates[track].solo) {
                        btn.classList.add('soloed');
                    } else {
                        btn.classList.remove('soloed');
                    }
                });
            }
            
            updateDisplay() {
                document.getElementById('bpmDisplay').textContent = this.bpm;
            }
            
            createSound(frequency, duration, type = 'sine', envelope = { attack: 0.01, decay: 0.1, sustain: 0.3, release: 0.1 }) {
                if (!this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.type = type;
                oscillator.frequency.value = frequency;
                
                const now = this.audioContext.currentTime;
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(envelope.sustain, now + envelope.attack);
                gainNode.gain.exponentialRampToValueAtTime(envelope.sustain * 0.3, now + envelope.attack + envelope.decay);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + duration - envelope.release);
                
                oscillator.start(now);
                oscillator.stop(now + duration);
            }
            
            createNoise(duration, filterFreq = 1000) {
                if (!this.audioContext) return;
                
                const bufferSize = this.audioContext.sampleRate * duration;
                const buffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);
                const data = buffer.getChannelData(0);
                
                for (let i = 0; i < bufferSize; i++) {
                    data[i] = Math.random() * 2 - 1;
                }
                
                const noise = this.audioContext.createBufferSource();
                const filter = this.audioContext.createBiquadFilter();
                const gainNode = this.audioContext.createGain();
                
                noise.buffer = buffer;
                noise.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                filter.type = 'highpass';
                filter.frequency.value = filterFreq;
                
                const now = this.audioContext.currentTime;
                gainNode.gain.setValueAtTime(0.3, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + duration);
                
                noise.start(now);
                noise.stop(now + duration);
            }
            
            shouldPlayTrack(track) {
                const state = this.trackStates[track];
                if (state.muted) return false;
                
                const hasSolo = Object.values(this.trackStates).some(s => s.solo);
                if (hasSolo) return state.solo;
                
                return true;
            }
            
            playStep() {
                const volume = this.masterVolume;
                
                // Update visual step indicator
                document.querySelectorAll('.step').forEach((step, index) => {
                    step.classList.toggle('active', index === this.currentStep);
                });
                
                // Play sounds based on patterns
                if (this.patterns.kick[this.currentStep] && this.shouldPlayTrack('kick')) {
                    this.createSound(60, 0.3, 'sine', { attack: 0.001, decay: 0.05, sustain: 0.8, release: 0.24 });
                }
                
                if (this.patterns.snare[this.currentStep] && this.shouldPlayTrack('snare')) {
                    this.createSound(200, 0.2, 'square', { attack: 0.001, decay: 0.02, sustain: 0.1, release: 0.18 });
                    this.createNoise(0.15, 2000);
                }
                
                if (this.patterns.hihat[this.currentStep] && this.shouldPlayTrack('hihat')) {
                    this.createNoise(0.1, 8000);
                }
                
                if (this.patterns.clap[this.currentStep] && this.shouldPlayTrack('clap')) {
                    this.createNoise(0.15, 1000);
                    setTimeout(() => {
                        this.createNoise(0.1, 1500);
                    }, 30);
                }
                
                if (this.patterns.bass[this.currentStep] && this.shouldPlayTrack('bass')) {
                    this.createSound(45, 0.4, 'sawtooth', { attack: 0.01, decay: 0.1, sustain: 0.6, release: 0.29 });
                }
                
                if (this.patterns.cowbell[this.currentStep] && this.shouldPlayTrack('cowbell')) {
                    this.createSound(800, 0.2, 'square', { attack: 0.001, decay: 0.05, sustain: 0.2, release: 0.15 });
                }
                
                this.currentStep = (this.currentStep + 1) % 8;
            }
            
            async togglePlay() {
                if (this.isPlaying) {
                    this.stop();
                } else {
                    await this.play();
                }
            }
            
            async play() {
                await this.initAudioContext();
                
                this.isPlaying = true;
                const playBtn = document.getElementById('playBtn');
                playBtn.textContent = '‚è∏ STOP';
                playBtn.classList.add('playing');
                
                const stepDuration = (60 / this.bpm / 2) * 1000; // 1/8 notes in milliseconds
                
                const step = () => {
                    if (!this.isPlaying) return;
                    
                    this.playStep();
                    
                    // Apply swing to odd steps
                    const swingDelay = (this.currentStep % 2 === 1) ? stepDuration * this.swing * 0.1 : 0;
                    
                    this.intervalId = setTimeout(step, stepDuration + swingDelay);
                };
                
                step();
            }
            
            stop() {
                this.isPlaying = false;
                if (this.intervalId) {
                    clearTimeout(this.intervalId);
                    this.intervalId = null;
                }
                
                const playBtn = document.getElementById('playBtn');
                playBtn.textContent = '‚ñ∂ PLAY';
                playBtn.classList.remove('playing');
                
                // Clear step indicators
                document.querySelectorAll('.step').forEach(step => {
                    step.classList.remove('active');
                });
                
                this.currentStep = 0;
            }
        }
        
        // Initialize the beatmaker when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new KoalaSparkBeatmaker();
        });
    </script>
</body>
</html>